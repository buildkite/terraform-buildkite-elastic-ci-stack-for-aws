steps:
  - label: ":terraform: Format Check"
    command: ".buildkite/scripts/format-check.sh"
    plugins:
      - docker#v5.11.0:
          image: "hashicorp/terraform:1.13"
          workdir: "/workdir"
          entrypoint: "/bin/sh"

  - label: ":terraform: Validate"
    command: ".buildkite/scripts/validate.sh"
    plugins:
      - docker#v5.11.0:
          image: "hashicorp/terraform:1.13"
          workdir: "/workdir"
          entrypoint: "/bin/sh"

  - label: ":lint-roller: TFLint"
    command: ".buildkite/scripts/tflint.sh"
    plugins:
      - docker#v5.11.0:
          image: "ghcr.io/terraform-linters/tflint:latest"
          workdir: "/workdir"
          entrypoint: "/bin/sh"

  - label: ":shield: Security Scan"
    command: ".buildkite/scripts/tfsec.sh"
    plugins:
      - docker#v5.11.0:
          image: "aquasec/tfsec:latest"
          workdir: "/workdir"
          entrypoint: "/bin/sh"

  - label: ":page_facing_up: Documentation Check"
    command: ".buildkite/scripts/docs-check.sh"
    plugins:
      - docker#v5.11.0:
          image: "quay.io/terraform-docs/terraform-docs:latest"
          workdir: "/workdir"
          entrypoint: "/bin/sh"

  - group: ":test_tube: Validate Examples"
    steps:
      - label: ":test_tube: {{matrix.example}}"
        command: ".buildkite/scripts/validate-example.sh {{matrix.example}}"
        matrix:
          setup:
            example:
              - "basic"
              - "complete"
              - "existing-vpc"
              - "scheduled-scaling"
              - "spot-instances"
        plugins:
          - docker#v5.11.0:
              image: "hashicorp/terraform:1.13"
              workdir: "/workdir"
              entrypoint: "/bin/sh"
